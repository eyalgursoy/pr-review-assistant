# AI Review Context Awareness — Summary

---

## File Roles (Read This First)

This implementation uses **three coordinated files**. Each has a specific purpose:

| File | Purpose | When to Use |
|------|---------|-------------|
| **[ai-review-context-plan.md](ai-review-context-plan.md)** | Master plan with detailed specifications | Reference for implementation details, code snippets, and requirements |
| **[ai-review-context-tasks.md](ai-review-context-tasks.md)** | Task checklist with completion status | Check/update task progress, see what's done vs pending |
| **[ai-review-context-summary.md](ai-review-context-summary.md)** (THIS FILE) | Running summary of completed work | **READ BEFORE EACH TASK** to understand prior context |

### For AI Agents: READ THIS FILE FIRST!

**Before starting ANY task, you MUST:**
1. Read this ENTIRE file to understand what has been done
2. Check [ai-review-context-tasks.md](ai-review-context-tasks.md) to see which task is next
3. Reference [ai-review-context-plan.md](ai-review-context-plan.md) for implementation details
4. Create a new branch for the task before implementing

**After completing a task, you MUST update this file with:**
- Task number and branch name
- Date completed
- Summary of changes made
- Files modified
- Key decisions or deviations from plan
- Any issues encountered and how they were resolved

---

## Key Terminology

| Term | Meaning |
|------|---------|
| `source: 'ai'` | Comment generated by the AI review in this session |
| `source: 'host'` | Comment fetched from GitHub/GitLab/Bitbucket (including previously submitted reviews) |
| `status` | Local user decision: `pending`, `approved`, `rejected` — persisted in Task 4 |

---

## Completed Tasks

### Task 1: Inject Existing Host Comments into AI Prompt

**Branch:** `task/1-inject-host-comments-into-prompt`
**Date:** 2026-02-19

**Changes Made:**

- **`src/review-template.ts`**: Added optional 7th parameter `existingComments?: ReviewComment[]` to `buildReviewPrompt`. When present and non-empty, the prompt now includes an "Already Filed Comments" section (before "## Code Changes") listing each comment as `**file:line** — issue` and instructing the AI not to repeat them.
- **`src/extension.ts`**: In `runReview()`, collect `hostComments = getAllComments().filter(c => c.source === "host")` and pass them to `buildReviewPrompt(..., hostComments)`.
- **`src/review-template.test.ts`**: Added 4 tests: no section when no/empty existing comments; section present with correct content when host comments provided; section placed before "## Code Changes".

**Files Modified:** `src/review-template.ts`, `src/extension.ts`, `src/review-template.test.ts`, `package.json`, `README.md`, `CHANGELOG.md`, `docs/ai-review-context-tasks.md`, `docs/ai-review-context-summary.md`

**Test Results:** 272/272 pass

---

## Test Commands

```bash
npm test
npm test -- src/review-template.test.ts
npm test -- src/state.test.ts
npm run build
npm run package
```

---

## Commit Message Format

```
feat(scope): short description

- Detail 1
- Detail 2

Refs: Task N from ai-review-context-plan
```
